---
layout: default
title: GitHub Actions Integration
---

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <h1 class="text-4xl font-bold text-gray-900 mb-8">GitHub Actions Integration</h1>
    
    <p class="text-xl text-gray-600 mb-12">
        Automatically check for migration issues in your CI/CD pipeline using Rails Migration Guard with GitHub Actions.
    </p>

    <section class="mb-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Basic Setup</h2>
        
        <p class="text-gray-600 mb-6">
            Add this workflow to your repository to check for migration issues on every pull request:
        </p>
        
        <div class="bg-gray-900 rounded-lg p-6 mb-8">
            <pre><code class="text-gray-100"># .github/workflows/migration-check.yml
name: Migration Check

on:
  pull_request:
    branches: [ main, master ]

jobs:
  check-migrations:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:14
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
        ports:
          - 5432:5432
    
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Required for branch comparison
      
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          bundler-cache: true
      
      - name: Setup database
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test
          RAILS_ENV: test
        run: |
          bundle exec rails db:create
          bundle exec rails db:schema:load
      
      - name: Check for migration issues
        env:
          DATABASE_URL: postgresql://postgres:postgres@localhost:5432/test
          RAILS_ENV: test
        run: |
          bundle exec rails db:migration:ci --strict</code></pre>
        </div>
    </section>

    <section class="mb-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Configuration Options</h2>
        
        <div class="bg-white rounded-lg border border-gray-200 overflow-hidden mb-8">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Option</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Default</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-sm">--strict</td>
                        <td class="px-6 py-4 text-sm text-gray-600">Fail on warnings (not just errors)</td>
                        <td class="px-6 py-4 text-sm text-gray-600">false</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-sm">--format</td>
                        <td class="px-6 py-4 text-sm text-gray-600">Output format (text/json)</td>
                        <td class="px-6 py-4 text-sm text-gray-600">text</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-sm">RAILS_ENV</td>
                        <td class="px-6 py-4 text-sm text-gray-600">Rails environment</td>
                        <td class="px-6 py-4 text-sm text-gray-600">test</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <section class="mb-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Exit Codes</h2>
        
        <p class="text-gray-600 mb-4">The CI command returns different exit codes based on the check results:</p>
        
        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-8">
            <li><code class="bg-gray-100 px-2 py-1 rounded">0</code> - No issues found</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">1</code> - Warnings found (orphaned migrations)</li>
            <li><code class="bg-gray-100 px-2 py-1 rounded">2</code> - Errors found (missing migrations or critical issues)</li>
        </ul>
    </section>

    <section class="mb-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Advanced Examples</h2>
        
        <h3 class="text-xl font-semibold text-gray-900 mb-3">Matrix Testing</h3>
        <p class="text-gray-600 mb-4">Test across multiple Ruby and Rails versions:</p>
        
        <div class="bg-gray-900 rounded-lg p-6 mb-8">
            <pre><code class="text-gray-100">strategy:
  matrix:
    ruby: ['3.1', '3.2', '3.3']
    rails: ['7.0', '7.1', '7.2']
    
steps:
  - uses: ruby/setup-ruby@v1
    with:
      ruby-version: ${{ matrix.ruby }}
      bundler-cache: true</code></pre>
        </div>
        
        <h3 class="text-xl font-semibold text-gray-900 mb-3">Conditional Checks</h3>
        <p class="text-gray-600 mb-4">Only run when migrations change:</p>
        
        <div class="bg-gray-900 rounded-lg p-6 mb-8">
            <pre><code class="text-gray-100">on:
  pull_request:
    paths:
      - 'db/migrate/**'
      - 'db/schema.rb'
      - 'db/structure.sql'</code></pre>
        </div>
        
        <h3 class="text-xl font-semibold text-gray-900 mb-3">Scheduled Monitoring</h3>
        <p class="text-gray-600 mb-4">Check for drift in staging environments:</p>
        
        <div class="bg-gray-900 rounded-lg p-6 mb-8">
            <pre><code class="text-gray-100">on:
  schedule:
    - cron: '0 9 * * 1-5'  # 9 AM UTC on weekdays
    
env:
  RAILS_ENV: staging
  DATABASE_URL: ${{ secrets.STAGING_DATABASE_URL }}</code></pre>
        </div>
    </section>

    <section class="mb-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Parsing JSON Output</h2>
        
        <p class="text-gray-600 mb-4">Use JSON format for advanced workflows:</p>
        
        <div class="bg-gray-900 rounded-lg p-6 mb-8">
            <pre><code class="text-gray-100">- name: Check migrations
  id: migration_check
  env:
    DATABASE_URL: ${{ secrets.DATABASE_URL }}
  run: |
    bundle exec rails db:migration:ci --format json > result.json || true
    echo "orphaned_count=$(jq '.orphaned | length' result.json)" >> $GITHUB_OUTPUT
    echo "missing_count=$(jq '.missing | length' result.json)" >> $GITHUB_OUTPUT
    
- name: Comment on PR
  if: steps.migration_check.outputs.orphaned_count > 0
  uses: actions/github-script@v6
  with:
    script: |
      github.rest.issues.createComment({
        issue_number: context.issue.number,
        owner: context.repo.owner,
        repo: context.repo.repo,
        body: '⚠️ Found ${{ steps.migration_check.outputs.orphaned_count }} orphaned migrations'
      })</code></pre>
        </div>
    </section>

    <section class="mb-16">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Best Practices</h2>
        
        <ul class="list-disc list-inside space-y-3 text-gray-600">
            <li><strong>Always use <code>fetch-depth: 0</code></strong> - The gem needs full git history to compare branches</li>
            <li><strong>Start without <code>--strict</code></strong> - Get warnings first, then enforce strict mode</li>
            <li><strong>Cache dependencies</strong> - Use <code>bundler-cache: true</code> for faster builds</li>
            <li><strong>Use secrets for database URLs</strong> - Never hardcode credentials in workflows</li>
            <li><strong>Run in parallel</strong> - Migration checks can run alongside your test suite</li>
        </ul>
    </section>

    <section>
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Next Steps</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <a href="./ci-integration.html" class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 border border-gray-200">
                <h3 class="font-semibold text-lg mb-2">CI/CD Integration</h3>
                <p class="text-gray-600 text-sm">Learn about other CI systems</p>
            </a>
            
            <a href="./configuration.html" class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow p-6 border border-gray-200">
                <h3 class="font-semibold text-lg mb-2">Configuration</h3>
                <p class="text-gray-600 text-sm">Customize Rails Migration Guard settings</p>
            </a>
        </div>
    </section>
</div>