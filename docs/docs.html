---
layout: default
title: Documentation
---

<div class="bg-gray-50 py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-4xl font-bold text-gray-900 mb-6">Documentation</h1>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                Complete guide to using Rails Migration Guard in your projects.
            </p>
        </div>
    </div>
</div>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Sidebar Navigation -->
        <div class="lg:col-span-1">
            <nav class="sticky top-20 space-y-8">
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">Getting Started</h3>
                    <ul class="space-y-2">
                        <li><a href="#installation" class="text-gray-600 hover:text-brand-600">Installation</a></li>
                        <li><a href="#quick-start" class="text-gray-600 hover:text-brand-600">Quick Start</a></li>
                        <li><a href="#configuration" class="text-gray-600 hover:text-brand-600">Configuration</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">Usage</h3>
                    <ul class="space-y-2">
                        <li><a href="#basic-commands" class="text-gray-600 hover:text-brand-600">Basic Commands</a></li>
                        <li><a href="#workflows" class="text-gray-600 hover:text-brand-600">Workflows</a></li>
                        <li><a href="#git-integration" class="text-gray-600 hover:text-brand-600">Git Integration</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 uppercase tracking-wider mb-4">Advanced</h3>
                    <ul class="space-y-2">
                        <li><a href="#customization" class="text-gray-600 hover:text-brand-600">Customization</a></li>
                        <li><a href="#troubleshooting" class="text-gray-600 hover:text-brand-600">Troubleshooting</a></li>
                        <li><a href="#api-reference" class="text-gray-600 hover:text-brand-600">API Reference</a></li>
                    </ul>
                </div>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="lg:col-span-3">
            <div class="prose prose-lg max-w-none">
                
                <!-- Installation -->
                <section id="installation" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Installation</h2>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Requirements</h3>
                    <ul class="list-disc list-inside mb-6">
                        <li>Rails 6.1+ or Rails 7.x</li>
                        <li>Ruby 3.0+</li>
                        <li>Git (for branch tracking)</li>
                    </ul>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Add to Gemfile</h3>
                    <div class="code-block rounded-lg p-6 mb-6">
                        <pre><code class="language-ruby text-gray-100"># Add to your Gemfile
group :development, :staging do
  gem 'rails_migration_guard'
end</code></pre>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Install and Setup</h3>
                    <div class="code-block rounded-lg p-6 mb-6">
                        <pre><code class="language-bash text-gray-100"># Install the gem
$ bundle install

# Generate the migration and configuration
$ rails generate migration_guard:install

# Run the migration to create the tracking table
$ rails db:migrate</code></pre>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Note:</strong> The gem only runs in development and staging environments by default. It won't affect your production performance.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Quick Start -->
                <section id="quick-start" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Quick Start</h2>
                    
                    <p class="text-lg text-gray-600 mb-6">
                        Once installed, Rails Migration Guard works automatically. Here's how to verify it's working:
                    </p>
                    
                    <div class="code-block rounded-lg p-6 mb-6">
                        <pre><code class="language-bash text-gray-100"># Check your current migration status
$ rails db:migration:status

# Run diagnostics to verify setup
$ rails db:migration:doctor</code></pre>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Your First Migration</h3>
                    <p class="text-gray-600 mb-4">Create and run a migration to see tracking in action:</p>
                    
                    <div class="code-block rounded-lg p-6 mb-6">
                        <pre><code class="language-bash text-gray-100"># Create a new migration
$ rails generate migration AddNameToUsers name:string

# Run the migration (this will be tracked automatically)
$ rails db:migrate

# Check the status to see your tracked migration
$ rails db:migration:status</code></pre>
                    </div>
                </section>
                
                <!-- Configuration -->
                <section id="configuration" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Configuration</h2>
                    
                    <p class="text-lg text-gray-600 mb-6">
                        Rails Migration Guard works out of the box, but you can customize its behavior:
                    </p>
                    
                    <div class="code-block rounded-lg p-6 mb-6">
                        <pre><code class="language-ruby text-gray-100"># config/initializers/migration_guard.rb
MigrationGuard.configure do |config|
  # Environments where MigrationGuard is active
  config.enabled_environments = [:development, :staging]
  
  # Git integration level
  config.git_integration_level = :warning  # :off, :warning, :auto_rollback
  
  # Branch configuration
  config.main_branch_names = %w[main master trunk]
  
  # Behavior options
  config.warn_on_switch = true
  config.auto_cleanup = false
  config.cleanup_after_days = 30
  
  # Logging
  config.log_level = :info
  config.colorize_output = true
end</code></pre>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Configuration Options</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Option</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Default</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">enabled_environments</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">[:development, :staging]</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">Environments where the gem is active</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">git_integration_level</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">:warning</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">Level of git integration (:off, :warning, :auto_rollback)</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">main_branch_names</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">["main", "master"]</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">Names to check for the main branch</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-900">warn_on_switch</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">true</td>
                                    <td class="px-6 py-4 text-sm text-gray-500">Show warnings when switching branches</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Basic Commands -->
                <section id="basic-commands" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Basic Commands</h2>
                    
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Check Migration Status</h3>
                            <div class="code-block rounded-lg p-6 mb-4">
                                <pre><code class="language-bash text-gray-100">$ rails db:migration:status</code></pre>
                            </div>
                            <p class="text-gray-600">Shows a comprehensive report of all migrations, their sync status with the main branch, and identifies orphaned migrations.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Rollback Orphaned Migrations</h3>
                            <div class="code-block rounded-lg p-6 mb-4">
                                <pre><code class="language-bash text-gray-100">$ rails db:migration:rollback_orphaned</code></pre>
                            </div>
                            <p class="text-gray-600">Interactively rollback migrations that exist locally but not in the main branch. You'll be prompted to confirm each rollback.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Run Diagnostics</h3>
                            <div class="code-block rounded-lg p-6 mb-4">
                                <pre><code class="language-bash text-gray-100">$ rails db:migration:doctor</code></pre>
                            </div>
                            <p class="text-gray-600">Runs comprehensive diagnostics to check your setup, git integration, and identify potential issues.</p>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Cleanup Old Records</h3>
                            <div class="code-block rounded-lg p-6 mb-4">
                                <pre><code class="language-bash text-gray-100">$ rails db:migration:cleanup FORCE=true</code></pre>
                            </div>
                            <p class="text-gray-600">Removes old tracking records based on your cleanup policy. Use FORCE=true to actually perform the cleanup.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Workflows -->
                <section id="workflows" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Common Workflows</h2>
                    
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Switching Branches</h3>
                            <div class="bg-gray-50 rounded-lg p-6 mb-4">
                                <ol class="space-y-2 text-gray-700">
                                    <li><span class="font-medium">1.</span> Check migration status before switching: <code class="text-sm bg-white px-2 py-1 rounded">rails db:migration:status</code></li>
                                    <li><span class="font-medium">2.</span> Switch to your target branch: <code class="text-sm bg-white px-2 py-1 rounded">git checkout main</code></li>
                                    <li><span class="font-medium">3.</span> Review any warnings about orphaned migrations</li>
                                    <li><span class="font-medium">4.</span> Rollback orphaned migrations if needed: <code class="text-sm bg-white px-2 py-1 rounded">rails db:migration:rollback_orphaned</code></li>
                                    <li><span class="font-medium">5.</span> Run any missing migrations: <code class="text-sm bg-white px-2 py-1 rounded">rails db:migrate</code></li>
                                </ol>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Before Merging a PR</h3>
                            <div class="bg-gray-50 rounded-lg p-6 mb-4">
                                <ol class="space-y-2 text-gray-700">
                                    <li><span class="font-medium">1.</span> Ensure you're on your feature branch</li>
                                    <li><span class="font-medium">2.</span> Run status check: <code class="text-sm bg-white px-2 py-1 rounded">rails db:migration:status</code></li>
                                    <li><span class="font-medium">3.</span> Verify no orphaned migrations exist</li>
                                    <li><span class="font-medium">4.</span> Commit all migration files to your branch</li>
                                    <li><span class="font-medium">5.</span> Push with confidence</li>
                                </ol>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Handling Orphaned Migrations</h3>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <p class="text-yellow-800 mb-2">
                                    <strong>When you see orphaned migrations:</strong>
                                </p>
                                <ul class="space-y-1 text-yellow-700 text-sm">
                                    <li>• Review each migration to understand what it does</li>
                                    <li>• Check if the migration should be kept (move to main branch)</li>
                                    <li>• Or rollback if it was experimental or belongs to abandoned features</li>
                                    <li>• Use the interactive rollback to make informed decisions</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Git Integration -->
                <section id="git-integration" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Git Integration</h2>
                    
                    <p class="text-lg text-gray-600 mb-6">
                        Rails Migration Guard can integrate with Git to automatically detect branch changes and warn about migration conflicts.
                    </p>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Install Git Hooks</h3>
                    <div class="code-block rounded-lg p-6 mb-6">
                        <pre><code class="language-bash text-gray-100"># Install post-checkout hook (warns on branch switch)
$ rails generate migration_guard:hooks

# Install pre-push hook (prevents pushing with orphaned migrations)
$ rails generate migration_guard:hooks --pre-push</code></pre>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-green-700">
                                    <strong>Recommended:</strong> Install both hooks for the best experience. The post-checkout hook provides immediate feedback, while the pre-push hook prevents accidentally pushing orphaned migrations.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Integration Levels</h3>
                    <div class="space-y-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 mb-2">:off</h4>
                            <p class="text-gray-600 text-sm">No git integration. Manual checking only.</p>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 mb-2">:warning (default)</h4>
                            <p class="text-gray-600 text-sm">Shows warnings about orphaned migrations when switching branches or pushing.</p>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 mb-2">:auto_rollback</h4>
                            <p class="text-gray-600 text-sm">Automatically prompts to rollback orphaned migrations when switching to main branch.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Troubleshooting -->
                <section id="troubleshooting" class="mb-16">
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Troubleshooting</h2>
                    
                    <div class="space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Common Issues</h3>
                            
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <h4 class="font-semibold text-red-800 mb-2">Git not found</h4>
                                <p class="text-red-700 text-sm mb-2">Ensure Git is installed and available in your PATH.</p>
                                <div class="code-block rounded p-2">
                                    <code class="text-xs text-gray-100">$ which git</code>
                                </div>
                            </div>
                            
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <h4 class="font-semibold text-red-800 mb-2">Migration tracking table not found</h4>
                                <p class="text-red-700 text-sm mb-2">Run the installation generator to create the tracking table.</p>
                                <div class="code-block rounded p-2">
                                    <code class="text-xs text-gray-100">$ rails generate migration_guard:install && rails db:migrate</code>
                                </div>
                            </div>
                            
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <h4 class="font-semibold text-red-800 mb-2">Hooks not working</h4>
                                <p class="text-red-700 text-sm mb-2">Check that git hooks are executable and properly installed.</p>
                                <div class="code-block rounded p-2">
                                    <code class="text-xs text-gray-100">$ ls -la .git/hooks/ | grep migration</code>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Debug Mode</h3>
                            <p class="text-gray-600 mb-4">Enable debug logging to troubleshoot issues:</p>
                            <div class="code-block rounded-lg p-6 mb-4">
                                <pre><code class="language-bash text-gray-100"># Enable debug logging
$ MIGRATION_GUARD_DEBUG=true rails db:migration:status

# Or set in your initializer
MigrationGuard.configure do |config|
  config.log_level = :debug
end</code></pre>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-semibold text-gray-900 mb-4">Getting Help</h3>
                            <p class="text-gray-600 mb-4">If you're still having issues:</p>
                            <ul class="space-y-2 text-gray-600">
                                <li>• Run <code class="text-sm bg-gray-100 px-2 py-1 rounded">rails db:migration:doctor</code> for diagnostic information</li>
                                <li>• Check the <a href="https://github.com/tommy2118/rails-migration-guard/issues" class="text-brand-600 hover:text-brand-700">GitHub issues</a> for similar problems</li>
                                <li>• Open a new issue with your diagnostic output</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>